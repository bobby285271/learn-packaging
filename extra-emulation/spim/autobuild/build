make -C spim
make -C xspim
cd QtSpim
rm -f parser_yacc.* scanner_lex.*

/usr/bin/qmake-qt5

# Fix Makefile generated by qmake.
sed -i 's#$(MOVE) help/qtspim.qhc help/qtspim.qhc;##' Makefile

MAKEFLAGS= make

cd ..

install -D QtSpim/QtSpim "$PKGDIR"/usr/bin/qtspim
install -D spim/spim "$PKGDIR"/usr/bin/spim
install -D xspim/xspim "$PKGDIR"/usr/bin/xspim
install -d "$PKGDIR"/usr/share/spim
install -Dm644 CPU/exceptions.s "$PKGDIR"/usr/share/spim
install -d "$PKGDIR"/usr/share/doc/spim
install -d "$PKGDIR"/usr/lib/qtspim/help/
install -Dm644 QtSpim/help/qtspim.qhc "$PKGDIR"/usr/lib/qtspim/help/
cp -r QtSpim/help "$PKGDIR"/usr/share/doc/spim/QtSpim
install -d "$PKGDIR"/usr/lib/qtspim/bin/
ln -sfv /usr/lib/qt5/bin/assistant "$PKGDIR"/usr/lib/qtspim/bin/
rm "$PKGDIR"/usr/share/doc/spim/QtSpim/*.{qch,qhc,qhcp,qhp}
cp -r Documentation/SourceForge/* "$PKGDIR"/usr/share/doc/spim/

install -Dm644 Documentation/qtspim.man "$PKGDIR"/usr/share/man/man1/qtspim.1
install -Dm644 Documentation/xspim.man "$PKGDIR"/usr/share/man/man1/xspim.1
install -Dm644 Documentation/spim.man "$PKGDIR"/usr/share/man/man1/spim.1
install -Dm644 Setup/qtspim_debian_deployment/qtspim.desktop \
    "$PKGDIR"/usr/share/applications/qtspim.desktop
install -Dm644 Setup/qtspim_debian_deployment/copyright \
    "$PKGDIR"/usr/share/licenses/$pkgname/copyright
install -Dm644 Setup/NewIcon48x48.png "$PKGDIR"/usr/share/qtspim/qtspim.png

cd "$SRCDIR"
